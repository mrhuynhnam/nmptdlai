import pandas as pd
import matplotlib.pyplot as plt

#Load dữ liệu
df = pd.read_excel('data_knn.xlsx',sheet_name="data")

#Xử lý dữ liệu
X = df[['t_i','c_i']].values # input
y = df[['result']].values # output

# Transform dữ liệu
X = X.astype(float)
y = y.astype(float)

#Chia tập dữ liệu thành trainning và testing
from sklearn.model_selection import train_test_split
X_train, X_test, y_train, y_test, indices_train, indices_test = train_test_split(X,y,df.index,
                                                                                 test_size=0.4, 
                                                                                 random_state=34)
#Huấn luyện mô hình với k=5
from sklearn.neighbors import KNeighborsClassifier
knnModel = KNeighborsClassifier(n_neighbors=5)
knnModel.fit(X_train, y_train)

# Dự báo mô hình trên tập X_test 
y_test_predicted =knnModel.predict(X_test)

#Đánh giá độ chính xác của mô hình với độ đo Accuracy trên tập test
from sklearn.metrics import accuracy_score
accuracy_score(y_test,y_test_predicted)

# Đánh giá với Confusion-Matrix
from sklearn.metrics import confusion_matrix
cf_matrix = confusion_matrix(y_test, y_test_predicted)

# Lưu mô hình huấn luyện
import pickle
pickle.dump(knnModel, open('model_KNN_Heart.sav', 'wb'))

#Xây dựng chương trình dự báo
import pickle
loaded_model = pickle.load(open('model_KNN_Heart.sav', 'rb'))

v1 = float(input('t_i: '))

v2 = float(input('c_i: '))

y_pred = loaded_model.predict([[v1,v2]])
print('Kết quả dự báo bệnh tim: '+ str(y_pred[0]))

if (y_pred[0] == 1):
    print("Bị bệnh tim")
else:
    print("Không bị bệnh")

